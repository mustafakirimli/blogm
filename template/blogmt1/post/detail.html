{% extends "base/page.html" %}
{% load i18n %}
{% load app_tags %}

{% block content %}
  <!-- post start //-->
  <div class="post">
      <h1 class="text-center">{{post.name}}</h1>
      <p class="text-right post-date">{{ post.created_at|date:'d M Y' }}</p>
      <br/>
      {% if post.image %}
      <img class="pimg" src="{{ MEDIA_URL }}{{post.image}}" width="200" heigth=""/>
      {% endif %}
      <p class="">{% autoescape off %}{{post.content}}{% endautoescape %}</p>  
  </div>
  <hr/>
  <!-- post end //-->
  
  <!-- comment start //-->
  <div class="comments">
  {% if comments %}
  <h4><i class="icon-comment"></i>  {{ comments.count }} Comment</h4>
  <br/>
  {% endif %}
  {% for comment in comments %}
    <div class="comment">
      <div class="avatar">
        <img src="http://www.gravatar.com/avatar/{{ comment.email|md5 }}" />
      </div>
      <div class="content">
        <div>
          <span><b>{{ comment.fullname }}</b></span>
          <span style="float: right">
            <a class="reply" data-id="{{ comment.id }}" href="#"><small>Reply</small></a>
          </span>
          <br/>
          <span><small>{{ comment.created_at|date:'Y-m-d H:i' }}</small></span>
        </div>
        <p>{{ comment.content }}</p>
      </div>
    </div>
  {% endfor %}
  </div>
  <!-- comment end //-->

  <!-- comment form start //-->
  {% url add_comment as action%}
  {% include "block/form.html" with action=action legend="Write Comment" submit="Send Comment" autofocus="on" %}
  <hr>
  <!-- comment form end //-->
{% endblock %}

{% block js %}<script>
  reply_mode_text = '{% trans "Write Comment Reply" %} (<small><a id="cancel_reply" href="#">{% trans "Cancel Reply Mode" %}</a></small>)'
  reply_id_el = jQuery("#id_reply_id")
  legend = reply_id_el.closest("form").find("legend")
  legend_default = legend.html()
  if(reply_id_el.val() != "")
    legend.html(reply_mode_text)

  jQuery("a.reply").click(function(e){
    e.preventDefault()
    legend.html(reply_mode_text)
    var reply_id = jQuery(this).data("id")
    reply_id_el.val(reply_id)
    location.hash = ""
    location.hash = "form_{{ form|get_hash }}"
  })

  legend.on("click", "#cancel_reply", function(e){
    e.preventDefault()
    legend.html(legend_default)
    reply_id_el.val("")
    return false;
  })
</script>{% endblock %} 